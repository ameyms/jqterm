/*! Terminal Emulator v0.2.4
(c) 2013 Amey Sakhadeo
MIT License: https://github.com/ameyms/jqterm/blob/master/LICENSE */
if(!jQuery)throw new Error("JqTerm requires jQuery");!function(a){var b='<div class="jq-term-history"></div><div class="jq-term-prompt" data-jsh="input"><div contenteditable="true" class="jq-term-prompt-input"></div></div>',c='<span class="jq-term-err">Error occured</span>',d='<span class="jq-term-op"></span>',e='<span class="jq-term-cmdline"></span>',f='<div class="jq-term-welcome"></div>',g={ENTER:13,TAB:9,UP:38,DOWN:40,BACKSPACE:8},h=function(){for(var b=!1,c=[],d="",e="",f=0,g=a.trim(g);f<g.length;f++)e=g[f]," "===e&&b===!1?(c.push(d),d=""):'"'===e?b===!0?(c.push('"'+d+'"'),b=!1,d=""):b=!0:d+=e;return d&&c.push(d),c},i=function(a){return a.replace("\\n","\n").replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/\\n/g,"<br>").replace(/ /g,"&nbsp;")},j=function(b){var c=a.Deferred();return c.resolveWith(b),c},k=function(a){return a===g.TAB?!0:void 0},l=function(a){var b=!1;switch(a[0]){case"clear":1===a.length&&(this.clearAll(),b=!0)}return b},m=function(b){this.$history.append("<br/>"),this.$history.append(a(f).html(b))},n=function(b){this.$el=a(b),this.interpreter=j,this.historyPtr=-1,this.history=[],this.format=function(a){return a.output}};n.DEFAULTS={},n.prototype.init=function(c){var d=this;c="object"==typeof c?c:{},c=a.extend({},n.DEFAULTS,c),this.$input=this.$el.append(a(b)).find(".jq-term-prompt-input").keydown(function(a){k(a.keyCode)?a.preventDefault():a.keyCode===g.ENTER?(a.preventDefault(),d.fireCommand()):a.keyCode===g.UP?d.rewindHistory():a.keyCode===g.DOWN?d.forwardHistory():a.keyCode===g.BACKSPACE&&1===d.$input.text().length&&a.preventDefault()}),d.$el.click(function(){d.$input.focus()}),"function"==typeof c.interpreter&&(this.interpreter=c.interpreter),this.$history=this.$el.find(".jq-term-history"),this.$prompt=this.$el.find(".jq-term-prompt"),c.welcome&&m.call(this,c.welcome),this.clearInputLine()},n.prototype.clearAll=function(){this.$history.html("")},n.prototype.clearInputLine=function(){this.$input.html("&nbsp;"),this.$input.focus()},n.prototype.rewindHistory=function(){+this.historyPtr>=0&&(this.$input.text(this.history[this.historyPtr]),this.historyPtr--)},n.prototype.forwardHistory=function(){this.historyPtr<this.history.length&&this.history.length>0&&this.$input.text(this.history[++this.historyPtr])},n.prototype.togglePrompt=function(){this.$prompt.toggle(),this.$input.focus()},n.prototype.fireCommand=function(){var b,c=this,d=a.trim(this.$input.text()),e=d?h(d):void 0;this.appendCmd(d),this.clearInputLine(),e&&(l.call(this,e)||(c.togglePrompt(),b=this.interpreter.call(this.$el,e),b.done(function(a){c.appendOutput(c.format(a)),c.togglePrompt()}),b.fail(function(a,b){c.appendError("Failed due to "+b),c.togglePrompt()})),(this.history.length<=0||this.history[length-1]!==d)&&this.history.push(d),this.historyPtr=this.history.length-1)},n.prototype.appendOutput=function(b){var c=i(b);this.$history.append(a(d).html(c))},n.prototype.appendCmd=function(b){this.$history.find(".jq-term-cmdline").length>0&&this.$history.append("<br/>"),this.$history.append(a(e).text("$ "+b)),a.trim(b)&&this.$history.append("<br/>")},n.prototype.appendError=function(b){this.$history.append("<br/>"),this.$history.append(a(c).text(b))},a.fn.term=function(b){return this.each(function(){if("active"===a(this).data("terminal"))throw new Error("Terminal already initialized");a(this).addClass("jq-term-term").attr("contenteditable",!1).data("terminal","active");var c=new n(a(this));c.init(b)})}}(jQuery,window);